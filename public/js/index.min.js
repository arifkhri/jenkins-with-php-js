$(document).ready(function(){let e={};const a=[{criteria:"no space left",message:"Error response: no space left on device"},{criteria:"Error from server (AlreadyExists)",message:"Error from server (AlreadyExists): namespaces"},{criteria:"504 Gateway Time-out",message:"Error: 504 Gateway Time-out"},{criteria:"/app/engine main.go' returned a non-zero code: 2",message:"Error Golang Report:  The command '/bin/sh -c go build -o /app/engine main.go' returned a non-zero code: 2"},{criteria:"Error: context deadline exceeded",message:"Kubernetes Error: context deadline exceeded"}],s=[/ERROR\sin+(.|\n)+?(?=npm)/g,/Failed\sto\scompile+(.|\n)+?(?=npm)/g,/Build\serror\soccurred+(.|\n)+?(?=npm)/g];function n(e){e||$("#spinner").removeClass("hidden"),$(".output").css("background-color","#fff"),$(".output").css("min-height","360px"),$("pre").addClass("hidden")}async function r(e){n(),$("#redeploy").addClass("hidden"),$(".empty").addClass("hidden");const r=await d("home","get_log",{webApp:e[0].value,branch:e[1].value});await async function(e){$("code").remove(),e=await function(e){let n="success";if(e.includes("Finished: FAILURE")){for(let s=0;s<a.length;s++)if(e.includes(a[s].criteria)){e=a[s].message+" (；☉_☉) Azzz..",n="FailServer";break}if("success"===n){e.includes("next");for(let a=0;a<s.length;a++){const r=e.match(s[a]);if(r){e=r,n="Fail";break}}}}else e="Deploy Success (ᵒ̤̑ ₀̑ ᵒ̤̑)wow!*✰";return{log:e,status:n}}(e),$(`<code class="bash">${e.log}</code>`).appendTo("pre"),$(".output").css("background-color","#011627"),"FailServer"===e.status?$("code").css("color","#c50c0c"):"success"===e.status&&$("code").css("color","#1C9116");$("pre code").each(function(e,a){hljs.highlightElement(a)})}(r),$(".output").css("min-height","0"),$("pre").removeClass("hidden"),$("#redeploy").removeClass("hidden"),$("#spinner").addClass("hidden")}function o(e,a,s){const n=new Option(a,s);$(e).append(n)}async function d(e,a,s){let n=null;return $("#web_app").prop("disabled",!0),$("#branch").prop("disabled",!0),await $.ajax({type:"POST",url:"/php/Ajax_Handler.php",data:{class:e,method:a,params:s},success:function(e){n=e}}),$("#web_app").prop("disabled",!1),$("#branch").prop("disabled",!1),n}!async function(){n();const a=await d("home","get_apps","");if(a){for(var s in data=JSON.parse(a),data)e={...e,...data[s]},o("#web_app",s,Object.keys(data[s])[0]);$("#spinner").addClass("hidden"),$(".empty").removeClass("hidden")}}(),$("#redeploy").on("click",function(){!async function(e){n(),(await d("home","build_app",{webApp:e[0].value,branch:e[1].value})).includes("success")&&($(".message").removeClass("hidden"),setTimeout(()=>{$(".message").addClass("hidden")},4e3)),$(".empty").removeClass("hidden"),$("#spinner").addClass("hidden")}($("form").serializeArray())}),$("#branch").on("change",function(){r($("form").serializeArray())}),$("#web_app").on("change",function(){$("#redeploy").addClass("hidden"),$(".empty").removeClass("hidden"),$("#branch").find("option").remove(),n(!0);const a=$("form").serializeArray()[0];for(var s in o("#branch","Select Branch",null),e[a.value])o("#branch",s,e[a.value][s]);$("#branch option:selected").attr("disabled","disabled")})});